<%# Simple announcement rendering: message may contain safe HTML from translations or YAML %>
<% active_announcements.each do |announcement| %>
  <% alert_type = announcement['type'] || 'info' %>
  <% version = announcement['version'] %>
  <% message = t("current_announcement") %>

  <div class="mt-3">
    <div class="alert alert-<%= alert_type %> alert-dismissible announcement-alert" role="alert" data-announcement-version="<%= version %>">
      <div class="text-muted">
        <%= message.respond_to?(:html_safe) ? message.html_safe : message %>
      </div>
      <button type="button" class="btn-close" aria-label="Close" onclick="dismissAnnouncement(<%= version %>)"></button>
    </div>
  </div>
<% end %>

<script>
function dismissAnnouncement(version) {
  $.ajax({
    url: '/announcements/dismiss',
    type: 'POST',
    data: { version: version },
    headers: {
      'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
    },
    success: function() {
      // Remove the announcement element from the DOM
      $('[data-announcement-version="' + version + '"]').fadeOut(300, function() {
        $(this).remove();
      });
    }
  });
}
</script>